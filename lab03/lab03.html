<!DOCTYPE html>
<HTML lang="en">
<BODY>
<canvas id="lab03" width="500" height="400" style="background-color: antiquewhite">
</canvas>
<script>
    function drawLine(idata, x0, y0, x1, y1) {
        if (x0 > x1 && y0 > y1) {
            [x0, x1] = [x1, x0];
            [y0, y1] = [y1, y0];
        }

        let y = y0;
        let eps = 0;
        const k = 2 * (y1 - y0);

        for (let x = x0; x <= x1; x++) {
            let Q = 255 * Math.abs(0.5 - (eps / (2 * (x1 - x0))));
            let P = 255 * Math.abs(0.5 + (eps / (2 * (x1 - x0))));

            idata.data[(x + y * idata.width) * 4 + 3] = Q;
            idata.data[(x + (y + 1) * idata.width) * 4 + 3] = P;
            eps = eps + k;

            if (eps > (x1 - x0)) {
                y++;
                eps = eps - 2 * (x1 - x0);
            }
        }
    }
</script>
<script>
    const canvas = document.getElementById("lab03");
    const ctx = canvas.getContext("2d");
    ctx.fillStyle = '#000000'
    const idata = ctx.getImageData(0, 0, canvas.width, canvas.height);

    let hasBeginPointSet = false;
    let x0;
    let y0;
    let x1;
    let y1;

    canvas.addEventListener("click", event => {
        if (!hasBeginPointSet) {
            x0 = event.offsetX;
            y0 = event.offsetY;
            hasBeginPointSet = true;

            // Для удобства, сразу показываем начальную точку
            ctx.fillRect(x0, y0, 2, 2)
            return
        }

        x1 = event.offsetX;
        y1 = event.offsetY;
        hasBeginPointSet = false;

        drawLine(idata, x0, y0, x1, y1);
        ctx.putImageData(idata, 0, 0);
    });
</script>
</BODY>
</HTML>